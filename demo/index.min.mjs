const trees=new WeakMap;function escape(e){const t=document.createElement("p");return t.textContent=e,t.innerHTML}function resolve(e,t){if(void 0!==e){const n=e[t];return"function"==typeof n?n.call():n}}function pluck(e,t){return escape(t.split(".").reduce(resolve,e)||"")}function bindings(e){const t=[];for(const n of e.childNodes)switch(n.nodeType){case 1:t.push(...bindAttributes(n)),t.push(...bindings(n));break;case 3:t.push(...bindText(n))}return t}function notifyTree(e){for(const t of e.observers)t();for(const t in e.children)notifyTree(e.children[t])}function appendChild(e,t){let n=e.children[t];return n||(n={name:t,children:{},observers:[]},e.children[t]=n),n}function compose(e,t){return function(){return e(t.apply(this,arguments))}}function descend(e,t,n){const r=compose(n,appendChild);return t.split(".").reduce(r,e)}function tree(e){let t=trees.get(e);return t||(t={children:{},observers:[]},trees.set(e,t)),t}function bind(e,t){const n=tree(t);for(const{target:r,key:o,update:s}of bindings(e)){const e=s.bind(r,t,o);descend(n,o,proxyOnce(t)).observers.push(e),s.call(r,t,o)}return e}function proxyOnce(e){let t=e;return function(e){return e.proxied||(proxy(t,e.name,notifyTree.bind(null,e)),e.proxied=!0),t=t[e.name],e}}function proxy(e,t,n){let r=e[t];Object.defineProperty(e,t,{get:()=>r,set:e=>{r=e,n()}})}function updateText(e,t){this.textContent=pluck(e,t)}function updateAttribute(e,t){this.value=pluck(e,t)}function parse(e){return e.split(/({{.+?}})/).map(e=>{return e.startsWith("{{")&&e.endsWith("}}")?{type:1,value:e.slice(2,-2).trim()}:{type:0,value:e}})}function bindAttributes(e){const t=[];for(const n of Array.from(e.attributes))for(const e of parse(n.value))1===e.type&&t.push({target:n,key:e.value,update:updateAttribute});return t}function bindText(e){const t=parse(e.textContent);if(1===t.length&&0===t[0].type)return[];const n=[];for(const r of t){const t=document.createTextNode(r.value);e.parentNode.insertBefore(t,e),1===r.type&&n.push({target:t,key:r.value,update:updateText})}return e.parentNode.removeChild(e),n}function stashe(e){return function(t){return bind(e,t)}}function SelectorSet(){if(!(this instanceof SelectorSet))return new SelectorSet;this.size=0,this.uid=0,this.selectors=[],this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var docElem=window.document.documentElement,matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;SelectorSet.prototype.matchesSelector=function(e,t){return matches.call(e,t)},SelectorSet.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)},SelectorSet.prototype.indexes=[];var idRe=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;SelectorSet.prototype.indexes.push({name:"ID",selector:function(e){var t;if(t=e.match(idRe))return t[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var classRe=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;SelectorSet.prototype.indexes.push({name:"CLASS",selector:function(e){var t;if(t=e.match(classRe))return t[0].slice(1)},element:function(e){var t=e.className;if(t){if("string"==typeof t)return t.split(/\s/);if("object"==typeof t&&"baseVal"in t)return t.baseVal.split(/\s/)}}});var Map,tagRe=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;SelectorSet.prototype.indexes.push({name:"TAG",selector:function(e){var t;if(t=e.match(tagRe))return t[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),SelectorSet.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}},Map="function"==typeof window.Map?window.Map:(function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e+" "]},e.prototype.set=function(e,t){this.map[e+" "]=t},e})();var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function parseSelectorIndexes(e,t){var n,r,o,s,i,c,a=(e=e.slice(0).concat(e.default)).length,u=t,l=[];do{if(chunker.exec(""),(o=chunker.exec(u))&&(u=o[3],o[2]||!u))for(n=0;n<a;n++)if(i=(c=e[n]).selector(o[1])){for(r=l.length,s=!1;r--;)if(l[r].index===c&&l[r].key===i){s=!0;break}s||l.push({index:c,key:i});break}}while(o);return l}function findByPrototype(e,t){var n,r,o;for(n=0,r=e.length;n<r;n++)if(o=e[n],t.isPrototypeOf(o))return o}function sortById(e,t){return e.id-t.id}SelectorSet.prototype.logDefaultIndexUsed=function(){},SelectorSet.prototype.add=function(e,t){var n,r,o,s,i,c,a,u,l=this.activeIndexes,p=this.selectors;if("string"==typeof e){for(n={id:this.uid++,selector:e,data:t},a=parseSelectorIndexes(this.indexes,e),r=0;r<a.length;r++)s=(u=a[r]).key,(i=findByPrototype(l,o=u.index))||((i=Object.create(o)).map=new Map,l.push(i)),o===this.indexes.default&&this.logDefaultIndexUsed(n),(c=i.map.get(s))||(c=[],i.map.set(s,c)),c.push(n);this.size++,p.push(e)}},SelectorSet.prototype.remove=function(e,t){if("string"==typeof e){var n,r,o,s,i,c,a,u,l=this.activeIndexes,p={},d=1===arguments.length;for(n=parseSelectorIndexes(this.indexes,e),o=0;o<n.length;o++)for(r=n[o],s=l.length;s--;)if(c=l[s],r.index.isPrototypeOf(c)){if(a=c.map.get(r.key))for(i=a.length;i--;)(u=a[i]).selector!==e||!d&&u.data!==t||(a.splice(i,1),p[u.id]=!0);break}this.size-=Object.keys(p).length}},SelectorSet.prototype.queryAll=function(e){if(!this.selectors.length)return[];var t,n,r,o,s,i,c,a,u={},l=[],p=this.querySelectorAll(this.selectors.join(", "),e);for(t=0,r=p.length;t<r;t++)for(s=p[t],n=0,o=(i=this.matches(s)).length;n<o;n++)u[(a=i[n]).id]?c=u[a.id]:(c={id:a.id,selector:a.selector,data:a.data,elements:[]},u[a.id]=c,l.push(c)),c.elements.push(s);return l.sort(sortById)},SelectorSet.prototype.matches=function(e){if(!e)return[];var t,n,r,o,s,i,c,a,u,l,p,d=this.activeIndexes,h={},f=[];for(t=0,o=d.length;t<o;t++)if(a=(c=d[t]).element(e))for(n=0,s=a.length;n<s;n++)if(u=c.map.get(a[n]))for(r=0,i=u.length;r<i;r++)!h[p=(l=u[r]).id]&&this.matchesSelector(e,l.selector)&&(h[p]=!0,f.push(l));return f.sort(sortById)};const bubbleEvents=new WeakMap,captureEvents=new WeakMap,propagationStopped=new WeakMap,immediatePropagationStopped=new WeakMap,currentTargets=new WeakMap,currentTargetDesc=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function before(e,t,n){const r=e[t];return e[t]=function(){return n.apply(e,arguments),r.apply(e,arguments)},e}function matches$1(e,t,n){const r=[];let o=t;do{if(1!==o.nodeType)break;const t=e.matches(o);if(t.length){const e={node:o,observers:t};n?r.unshift(e):r.push(e)}}while(o=o.parentElement);return r}function trackPropagation(){propagationStopped.set(this,!0)}function trackImmediate(){propagationStopped.set(this,!0),immediatePropagationStopped.set(this,!0)}function getCurrentTarget(){return currentTargets.get(this)||null}function defineCurrentTarget(e,t){currentTargetDesc&&Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:t||currentTargetDesc.get})}function getEventsStore(e,t){let n={};return e?(captureEvents.has(t)||captureEvents.set(t,n),n=captureEvents.get(t)):(bubbleEvents.has(t)||bubbleEvents.set(t,n),n=bubbleEvents.get(t)),n}function dispatch(e){const t=e.currentTarget,n=getEventsStore(1===e.eventPhase,t)[e.type];if(!n)return;const r=matches$1(n,e.target,1===e.eventPhase);if(r.length){before(e,"stopPropagation",trackPropagation),before(e,"stopImmediatePropagation",trackImmediate),defineCurrentTarget(e,getCurrentTarget);for(let t=0,n=r.length;t<n&&!propagationStopped.get(e);t++){const n=r[t];currentTargets.set(e,n.node);for(let t=0,r=n.observers.length;t<r&&!immediatePropagationStopped.get(e);t++)n.observers[t].data.call(n.node,e)}currentTargets.delete(e),defineCurrentTarget(e)}}function on(e,t,n,r={}){const o=!!r.capture,s=r.document||document,i=getEventsStore(o,s);let c=i[e];c||(c=new SelectorSet,i[e]=c,s.addEventListener(e,dispatch,o)),c.add(t,n)}function off(e,t,n,r={}){const o=!!r.capture,s=r.document||document,i=getEventsStore(o,s),c=i[e];c&&(c.remove(t,n),c.size||(delete i[e],s.removeEventListener(e,dispatch,o)))}class AppComponent extends HTMLElement{constructor(){super(),this.observedAttributes={},this.data=new Proxy({},{set:function(e,t,n){if(e[t]=n,this.observedAttributes[t])for(let e of this.observedAttributes[t])e(t,n);return!0}.bind(this)}),this.callbacks={connect:[],attributechange:[],disconnect:[]}}initTemplate(e,t){let n=stashe(AppComponent.template(e).content.cloneNode(!0));this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(n(t));const r={document:this.shadowRoot};this.addListener=(e=>{const t=e.slice();t.push(r),on.apply(null,t)}),this.removeListener=(e=>{const t=e.slice();t.push(r),off.apply(null,t)})}attributeChangedCallback(e,t,n){if(!this.isConnected||n===t||null===n)return!1;for(const[t]of Object.entries(this.observedAttributes))t===e&&(n=this.parseAttribute(n));this.data[e]!==n&&(this.data[e]=n),this.runCallbacks("attributechange")}connectedCallback(){if(this.isConnected){for(const[e]of Object.entries(this.observedAttributes))this.data[e]=this.parseAttribute(this.getAttribute(e));if(this.eventListeners)for(let e of this.eventListeners)e&&3===e.length&&this.addListener(e);this.runCallbacks("connect")}}disconnectedCallback(){if(this.eventListeners)for(let e of this.eventListeners)e&&3===e.length&&this.removeListener(e);this.runCallbacks("disconnect")}serializeAttribute(e){let t=e;return e?t="string"==typeof e?e:JSON.stringify(e):null}parseAttribute(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return e}}on(e,t){return this.callbacks[e]?(this.callbacks[e].push(t),!0):(console.log(`An event with the name of "${e}" is not supported.`),!1)}runCallbacks(e){if(this.callbacks[e])for(let t of this.callbacks[e])"function"==typeof t&&t()}}AppComponent.init=function(e,t,n){for(let n of t.observedAttributes)e.observedAttributes[n]=[];e.initTemplate(n,e.data),Object.assign(e,AppComponent.gatherElements(e.shadowRoot,"data-element"))},AppComponent.template=function(e){const t=document.createElement("template");return t.innerHTML=e,t},AppComponent.gatherElements=function(e,t){let n={},r=e.querySelectorAll("["+t+"]");for(let e of r){n["$"+e.getAttribute(t)]=e}return n};var tpl='<style> </style> <div class="hostdiv"> <div><span>hello!</span></div> <div></div> <div>{{ replaceme }}! {{ helpme }}</div> </div> ';class TestComponent extends AppComponent{constructor(){super(),AppComponent.init(this,TestComponent,tpl)}get eventListeners(){return[["click","span",function(e){console.log("hey!")}]]}static get observedAttributes(){return["helpme","replaceme"]}}window.customElements.define("test-component",TestComponent);var tpl$1='<template data-element="choiceTpl"> <div class="choice"><input type="radio" name id value><label for></label></div> </template> ';class InRadio extends AppComponent{constructor(){super(),AppComponent.init(this,InRadio,tpl$1),this.observedAttributes.choices.push(this.renderChoices.bind(this)),this.observedAttributes.choice.push(function(e,t){this.setAttribute(e,this.serializeAttribute(t));const n=this.shadowRoot.querySelector("[value="+this.data.choice+"]");n&&(n.checked=!0)}.bind(this))}get eventListeners(){return[["click","input",function(e){const t=this.shadowRoot.querySelector(":checked");this.data.choice=t.getAttribute("value")}.bind(this)]]}renderChoices(){const e=this.shadowRoot,t=this.$choiceTpl,n=this.data["in-name"],r=this.data.choices;if(!(e&&t&&n&&r))return;e.querySelectorAll(".choice").forEach(e=>{e.remove()});let o=!1;for(let s of r){let r=t.content.cloneNode(!0),i="_"+Math.random().toString(36).substr(2,9),c=r.querySelector("input"),a=r.querySelector("label");c.setAttribute("name",n),c.setAttribute("id",i),c.setAttribute("value",s),a.setAttribute("for",i),a.textContent=s,o||(c.checked=!0,o=!0,this.data.choice=s),e.appendChild(r)}}static get observedAttributes(){return["in-name","choices","choice"]}}window.customElements.define("in-radio",InRadio);
